<krpano>

	<include url="%VIEWER%/plugins/webvr.xml" devices="mobilevr" />
	<include url="%VIEWER%/plugins/iphone_fullscreen_swipe.xml" />
	<!-- <include url="%VIEWER%/plugins/controls3d.xml" /> -->
	<include url="%VIEWER%/plugins/drag3d.xml" />
	
	<plugin api="threejs" keep="true" url="%VIEWER%/plugins/threejs_krpanoplugin.js" />

	<!-- use a reduced depthbuffer range for better rendering accuracy -->
	<display depthrange="5,200000" />
	<threejs
		shadowmap="pcf"
		ambientlight="1.0"
		/>

	<webvr postracking="true" />
	<control collision="true" groundcollision="true" usevrfloorlevel="true" />
	<control
       movetolimit="true"
       movetolimitx="-200"
       movetolimity="-200"
       movetolimitz="-400"
      />

	<!-- add a rotating light -->
	<!-- <hotspot name="light" keep="true"
		type="threejslight"
		mode="sun"
		intensity="3.0"
		color="0xFFFFFF"
		ath="0" atv="-30"
		onloaded="asyncloop(loaded, ath=timertick*0.02);"
		/> -->
	<!-- show shadows using a virtual floor and an invisible light -->
	<threejs shadowfloor="true" shadowfloorlevel="148" shadowflooralpha="0.15" />
	<hotspot name="floorshadowlight" type="threejslight" mode="sun" intensity="0.0" castshadow="true" shadowmapres="1024" ath="0" atv="-90" keep="true" />

	<hotspot name="women" keep="true"
		type="threejs"
		url="../woman.glb"
		scale="0.005"
		depth="0"
		tx="20" ty="0" tz="0"
		onloaded="centermodel();"
		ondown="drag3d();"
		/>

	<!-- the startup view -->
	<view hlookat="0" vlookat="0" fov.normal="95" fov.mobile="105" tx="0" ty="0" tz="-160" />

	<!-- some example scenes -->
	<scene name="s1" autoload="true">
		<threejs envmapurl="preview" />
		<image objectsize="infinity">
          <preview url="panos/07.tiles/preview.jpg"/>
          <cube url="panos/07.tiles/%s/l%l/%v/l%l_%s_%v_%h.jpg" multires="512,1024,2048,3840"/>
        </image>
	</scene>

	<scene name="s2">
		<threejs envmapurl="preview" />
		<image objectsize="infinity">
            <preview url="panos/09.tiles/preview.jpg"/>
            <cube url="panos/09.tiles/%s/l%l/%v/l%l_%s_%v_%h.jpg" multires="512,1024,2048,3840"/>
        </image>
	</scene>

	 <scene name="s3">
		 <threejs envmapurl="preview" />
		<view fovmin="20" fovmax="150" />
		 <image objectsize="infinity">
			<sphere url="skin/sky.jpg" />
			<!-- <cube url="panos/015.tiles/%s/l%l/%v/l%l_%s_%v_%h.jpg" multires="512,1024,2048,3840"/> -->
		</image>

		<hotspot name="light"
		type="threejslight"
		mode="sun"
		ath="180.0"
		atv="-60.0"
		colortemperature="6500"
		intensity="1.0"
		castshadow="true"
		shadowmapres="2048"
		/>

	   <hotspot name="soldier"
		type="threejs"
		url="../landscape.glb"
		 depth="0"
		 scale="8.0"
		 hittest="true"
		 castshadow="true"
		 receiveshadow="true"
		 ry="180"
         tx="0"
         ty="170"
         tz="300"   
		 visible="true"
         enabled="true"
         capture="true"
		/>

	</scene>

	<!-- <scene name="s4">
		<threejs envmapurl="skin/envmap1.jpg" />

		<image>
			<sphere   url="skin/habitacio_01.jpg" />
			<depthmap url="skin/habitacio_01_depthmap.jpg" enabled="true" mapmode="1" scale="0.5" offset="0.293" curve="1.0" hittest="true" />
		</image>
	</scene> -->

	<!-- thumbs for scene switching -->
	<settings loadflags="MERGE|KEEPMOVING" blending="SLIDEBLEND(1.5)" />

	<style name="thumb" bgborder="3 0xFFFFFF 1" bgshadow="0 0 1 0 0x000000 1.0 inset,0 3 4 0x000000 0.5" width="relink:stagewidth:stagewidth LT 550 ? 40 : 60" height="relink:stagewidth:stagewidth LT 550 ? 40 : 60" />

	<layer keep="true" type="container" width="100%" align="bottom" y="20">
		<layer type="scrollarea" align="top" direction="h" flowchildren="h" childflowspacing="16" childmargin="16" onresize="parentobject.height=height;">
			<!-- <layer style="thumb" type="text" text="X" textalign="center" bgcolor="0xAAAAAA" onclick="remove_envmap();" /> -->
			<layer style="thumb" url="panos/07.tiles/thumb.jpg" onclick="loadscene(s1, null, get(settings.loadflags), get(settings.blending));" />
			<layer style="thumb" url="panos/09.tiles/preview.jpg" onclick="loadscene(s2, null, get(settings.loadflags), get(settings.blending));" />
			<layer style="thumb" url="skin/texture_preview.jpg" onclick="loadscene(s3, null, get(settings.loadflags), get(settings.blending));" />
			<!-- <layer style="thumb" url="skin/thumb.jpg" onclick="loadscene(s4, null, get(settings.loadflags), get(settings.blending));" /> -->
		</layer>
	</layer>

	<!-- remove the environment by reloading the current image and setting envmapurl to null -->
	<action name="remove_envmap">
		image.reset(copy);
		loadpanoimage(get(settings.loadflags), get(settings.blending));
		threejs.envmapurl=null;
	</action>

	<layer name="info" keep="true"
		type="text"
		text="data:infotext"
		width="320"
		bg="false"
		css="color:#FFFFFF; font-size:14px; text-align:center; line-height:18px;"
		txtshadow="0 1 4 0x000000 1.0"
		align="top"
		y="100"
		onclick="set(enabled,false); tween(alpha,0,0.5,default,remove());"
		onloaded="delayedcall(12, onclick() );"
		/>

</krpano>