<krpano version="1.22">


	<!-- load the first scene on startup -->
	<action name="startup" autorun="onstart">
		loadscene(scene_05, null, MERGE);
	</action>
	
	
	<action name="scene3dtransition" scope="local" args="scenename, hlookatoffset">
        transitiontime = 1;
        transitiontweentype = "easeinoutexpo";
		loadscene(get(scenename), null, MERGE|PRELOAD, BLEND(get(transitiontime),get(transitiontweentype)));
	</action>
	

	<!-- pagedown/pageup keys -->
	<events onkeydown="if(keycode == 33, nextscene(-1),
	                      keycode == 34, nextscene(+1)
	                     );" />

	<action name="nextscene" scope="local" args="add_to_index">
		new_scene_index = scene[*xml.scene].index + add_to_index;
		if(new_scene_index GE scene.count, new_scene_index = 0;
		  ,new_scene_index LT 0, new_scene_index = scene.count-1;
		);
		loadscene(*new_scene_index, null, MERGE|KEEPVIEW, BLEND(0.5));
	</action>

  <!-- JS Helper to inject buttons -->
  <action name="addFloorScenes">
    removelayer(scene_list);
    addlayer(scene_list);
    copy(layer[scene_list].width, layer[dropdown_floor].width);
    copy(layer[scene_list].align, layer[dropdown_floor].align);
    addSceneButton('First screen', 'scene_05');
    addSceneButton('Second screen', 'scene_07');
	addSceneButton('Third screen', 'scene_09');
  </action>

  <action name="addSceneButton">
    addlayer(scene_%2);
    set(layer[scene_%2].parent, scene_list);
    set(layer[scene_%2].type, text);
    set(layer[scene_%2].html, %1);
    set(layer[scene_%2].width, 100%);
    set(layer[scene_%2].height, 40);
    set(layer[scene_%2].css, 'font-size:16px; text-align:center; line-height:40px; color:#007A33; background:#f0f0f0; border-radius:5px; margin:5px;');
    set(layer[scene_%2].onclick, 'loadscene(%2, null, MERGE, BLEND(1));');
  </action>

	<!-- the map image -->
	<layer name="map" url="skin/inmap.png" keep="true" handcursor="false" capture="false"
	       align="leftbottom"
	       scale="0.25" scalechildren="true"
	       onclick="openmap();"
	       />

	<!-- map opening - scale the map up to 100% (or smaller if the screen is too small) -->
	<action name="openmap">
		set(layer[map].onclick, closemap(); );
		layer[map].changealign(center,center);

		set(bigscale,1);
		if(layer[map].sourcewidth GT stagewidth, bigscale = stagewidth / layer[map].sourcewidth; );

		tween(layer[map].x, 0);
		tween(layer[map].y, 0);
		tween(layer[map].scale, get(bigscale));
	</action>

	<!-- map closing - scale the map back to 0.25 of its image pixelsize -->
	<action name="closemap">
		set(layer[map].onclick, openmap(); );
		layer[map].changealign(leftbottom,leftbottom);

		tween(layer[map].x, 0);
		tween(layer[map].y, 0);
		tween(layer[map].scale, 0.25);
	</action>

	<!-- action for loading the scene when clicking on the map spots -->
	<action name="mapspot_loadscene">
		if(layer[map].scale GT 0.25,
			<!-- special mode for zoomed map: hide big map, loadscene, show small map -->
			set(layer[map].enabled, false);
			tween(layer[map].alpha, 0.0, 0.25, default,
				loadscene(%1, null, MERGE, BLEND(1));

				set(layer[map].onclick, openmap(); );
				layer[map].changealign(leftbottom,leftbottom);

				set(layer[map].x, 0);
				set(layer[map].y, 0);
				set(layer[map].scale, 0.25);

				set(events[sceneload].onloadcomplete,
					delayedcall(1,
						tween(layer[map].alpha, 1.0, 0.5, default, set(layer[map].enabled, true); );
					  );
				  );
			  );
		  ,
			<!-- small map: just load the scene -->
			loadscene(%1, null, MERGE, BLEND(1));
		  );
	</action>

	<!-- hotspot animation code -->
	<action name="hotspot_animate">
		if(loaded,
			inc(frame,1,get(frames),0);
			mul(ypos,frame,frameheight);
			txtadd(crop,'0|',get(ypos),'|',get(framewidth),'|',get(frameheight));
			delayedcall(0.1, hotspot_animate() );
		  );
	</action>

	<!-- the map spot images -->
	<style name="mapspot" keep="true" url="skin/camicon.png" parent="map" align="lefttop" edge="center" scale.mobile="2" />
	
	<!-- hotspot styles (black and white hotspots) -->
	<style name="hotspot_ani_black"
	       url="skin/hotspot_ani_black.png"
	       crop="0|0|64|64"
	       frames="20" framewidth="64" frameheight="64" frame="0"
	       onloaded="hotspot_animate();"
	       />

	<style name="hotspot_ani_white"
	       url="skin/hotspot_ani_white.png"
	       crop="0|0|64|64"
	       frames="20" framewidth="64" frameheight="64" frame="0"
	       onloaded="hotspot_animate();"
	       />

	<layer name="spot1" style="mapspot" x="474" y="314" zorder="1" onclick="mapspot_loadscene(scene_05);" />
	<layer name="spot2" style="mapspot" x="172" y="488" zorder="1" onclick="mapspot_loadscene(scene_07);" />
	<layer name="spot3" style="mapspot" x="732" y="315" zorder="1" onclick="mapspot_loadscene(scene_09);" />

	<!-- active spot image (overlays the normal spot) -->
	<layer name="activespot" url="skin/camicon_red.png" keep="true"
	       align="lefttop" zorder="2" 
	       />

	<!-- radar layer (overlays the normal spot too, but is behind the activespot image) -->
	<layer name="radar" keep="true"
	       url="%VIEWER%/plugins/radar.js"
	       align="center" zorder="1"
	       scale.mobile="1.5"
	       fillalpha="0.5" fillcolor="0x7F5F3F"
	       linewidth="1.0" linecolor="0xE0E0A0" linealpha="0.5"
	       />

<!-- the tour scenes -->

<scene name="scene_05" title="First screen" onstart="updateradar()" thumburl="panos/05.tiles/thumb.jpg" lat="24.68769445" lng="46.68352778" alt="571.80" heading="0.0">

<action name="updateradar">
			layer[activespot].parent = 'spot1';
			layer[radar].parent = 'spot1';
</action>

<view hlookat="202.65" vlookat="8.12" fov="105.5" maxpixelzoom="2.0" fovmin="60" fovmax="120" />
<image>
<preview url="panos/05.tiles/preview.jpg"/>
<cube url="panos/05.tiles/%s/l%l/%v/l%l_%s_%v_%h.jpg" multires="512,1024,2048,3840"/>
</image>

<hotspot name="spot1" style="hotspot_ani_white" ath="2.56" atv="10.54" depth="900" prealign="true" onclick="scene3dtransition(scene_09);" />
<hotspot name="spot2" style="hotspot_ani_white" ath="154.20" atv="1.22" depth="1000" prealign="true" onclick="scene3dtransition(scene_07);" />
</scene>

<scene name="scene_07" title="Second screen" onstart="updateradar()" thumburl="panos/07.tiles/thumb.jpg" lat="24.68738888" lng="46.68363888" alt="603.10" heading="0.0">

<action name="updateradar">
			layer[activespot].parent = 'spot2';
			layer[radar].parent = 'spot2';
		</action>

		<view hlookat="-151.42" vlookat="4.18" fov="99.5" maxpixelzoom="2.0" fovmin="60" fovmax="120" />
<image>
<preview url="panos/07.tiles/preview.jpg"/>
<cube url="panos/07.tiles/%s/l%l/%v/l%l_%s_%v_%h.jpg" multires="512,1024,2048,3840"/>
</image>

<hotspot name="videospot"
	         url="%VIEWER%/plugins/videoplayer.js"
	         videourl="videos/flower.mp4"
	         posterurl="videos/tree.png"
	         distorted="true"
	         ath="60"
	         atv="0"
			 width="80"
             height="50"
	         scale="1.0"	        
	         loop="true"
			 muted="true"
	         pausedonstart="false"
	         onclick="togglepause();"
/>
<hotspot name="spot1" style="hotspot_ani_white" ath="234.00" atv="0.00" depth="600" prealign="true" onclick="scene3dtransition(scene_05);" />
</scene>

<scene name="scene_09" title="Third screen" onstart="updateradar()" thumburl="panos/09.tiles/thumb.jpg" lat="24.68775000" lng="46.68338888" alt="595.30" heading="0.0">

<action name="updateradar">
			layer[activespot].parent = 'spot3';
			layer[radar].parent = 'spot3';
</action>

<view hlookat="-99.5" vlookat="21.1" fov="99.5" maxpixelzoom="2.0" fovmin="60" fovmax="120" />
<image>
<preview url="panos/09.tiles/preview.jpg"/>
<cube url="panos/09.tiles/%s/l%l/%v/l%l_%s_%v_%h.jpg" multires="512,1024,2048,3840"/>
</image>
	<hotspot name="spot1" style="hotspot_ani_white" ath="269.92" atv="10.91" depth="600" prealign="true" onclick="scene3dtransition(scene_05);" />
	<hotspot name="spot2" style="hotspot_ani_white" ath="254.27" atv="-1.025" depth="1000" prealign="true" onclick="scene3dtransition(scene_07);" />
</scene>

</krpano>   